package liter

/*
	Модуль предоставляет потокобезопасный тип для работы с отдельной литерой.
*/

import (
	мФмт "fmt"
	мСтр "strings"
	мСинх "sync"
)

//СЛит -- специальный строковый тип для хранения литеры исходного текста
type СЛит string

//СЛитКласс -- специальный целочисленный класс для хранения признака класса литеры
type СЛитКласс int

//ТЛит -- тип для работы с отдельной литерой
type ТЛит struct {
	лит    СЛит
	цКласс СЛитКласс //Хранит класс литеры
	блок   мСинх.Mutex
}

const (
	//наборы букв для перебора
	стрБуквыРус = "абвгдеёжзийклмнопрстуфхцчшщьыъэюяАБВГДЕЁЖЗИЙКЛМНОПРСТУФХЦЧШЩЬЫЪЭЮЯ"
	стрБуквыАнг = "abcdefghjiklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"
	стрБуквыВсе = стрБуквыРус + стрБуквыАнг

	//CтрЦифры -- список цифр, что могут встречаться в числах
	стрЦифры = "0123456789."

	//Различные специальные литеры, не имеющие смысла в коде
	стрСпецЛит           = "`~!@#№$%^&?\\_"
	кПусто     СЛитКласс = iota + 1
	кБуква
	кСпецЛит
	кЦифра
)

//ЛитераНов -- возвращает указатель на новый ТЛит
func ЛитераНов() (лит *ТЛит) {
	return &ТЛит{}
}

// ЕслиБуква -- проверяет наличие буквы в литере
func (сам *ТЛит) ЕслиБуква() bool {
	defer сам.блок.Unlock()
	сам.блок.Lock()
	if сам.цКласс == кБуква {
		return true
	}
	return false
}

// ЕслиСпецЛит -- проверяет наличие специальных литер не имеющих смысла в коде
func (сам *ТЛит) ЕслиСпецЛит() bool {
	defer сам.блок.Unlock()
	сам.блок.Lock()
	if сам.цКласс == кСпецЛит {
		return true
	}
	return false
}

//ЕслиЦифра -- проверяет, что литера цифра
func (сам *ТЛит) ЕслиЦифра() bool {
	defer сам.блок.Unlock()
	сам.блок.Lock()
	if сам.цКласс == кЦифра {
		return true
	}
	return false
}

//Уст -- устанавливает хранимую литеру
func (сам *ТЛит) Уст(пЛит СЛит) {
	defer сам.блок.Unlock()
	сам.блок.Lock()
	if пЛит == "" {
		panic(мФмт.Errorf("ТЛит.Уст(): пЛит не может быть пустой\n"))
	}
	сам.лит = пЛит
	if мСтр.Contains(стрБуквыВсе, string(пЛит)) {
		сам.цКласс = кБуква
		return
	}
	if мСтр.Contains(стрСпецЛит, string(пЛит)) {
		сам.цКласс = кСпецЛит
		return
	}
	if мСтр.Contains(стрЦифры, string(пЛит)) {
		сам.цКласс = кЦифра
		return
	}
	panic(мФмт.Errorf("ТЛит.Уст(): ОШИБКА неизвестный класс литеры, пЛит=[%v]\n", пЛит))
}

//Получ -- возвращает хранимую литеру
func (сам *ТЛит) Получ() СЛит {
	defer сам.блок.Unlock()
	сам.блок.Lock()
	return сам.лит
}

func (сам *ТЛит) String() string {
	defer сам.блок.Unlock()
	сам.блок.Lock()
	return мФмт.Sprint(сам.лит)
}
